import{u as q,r as d,a as D,c as T,j as e,N as te,G as o,d as g,M as _,e as ae,B as p,s as L,k as se,t as R,m as O,Q as ne,L as re,n as le,o as ie,S as oe,y as de,p as ce,q as he,v as ue,w as me,x as ge,R as xe,U as fe,z as U,A as W,V as je,E as I,W as be}from"./index-CgMpkwRO.js";const z=a=>{if(!a)return"";const x=new Date(a),C=String(x.getDate()).padStart(2,"0"),v=String(x.getMonth()+1).padStart(2,"0");return`${x.getFullYear()}-${v}-${C}`};function pe({data:a,onClose:x}){q();const[C,v]=d.useState([]),[i,y]=d.useState({stu_id:a?a.stu_id:"",stu_name:a?a.stu_name:"",aadhar_no:a?a.aadhar_no:"",gender:a?a.gender:"",dob:a?z(a.dob):"",date_of_join:a?z(a.date_of_join):"",cls_id:a?a.cls_id:"",community:a?a.community:"",father_name:a?a.father_name:"",father_mobile:a?a.father_mobile:"",mother_name:a?a.mother_name:"",mother_mobile:a?a.mother_mobile:"",bookingfees:a?a.bookingfees:"",address:a?a.address:"",Totalfees:a?a.total_fees:""}),[r,j]=d.useState({}),[A,b]=d.useState(!1),[N,$]=d.useState(!1),M=(m,u)=>{let n="";const l=u&&typeof u=="string"?u.trim():u,f=s=>/^[6-9]\d{9}$/.test(s),k=s=>/^\d{12}$/.test(s),E=s=>/^\d{4}-\d{2}-\d{2}$/.test(s);switch(m){case"cls_id":l||(n="Please select Class");break;case"stu_name":l?/^[a-zA-Z\s]+$/.test(l)||(n="Student Name must contain only letters and spaces"):n="Please enter Student Name";break;case"aadhar_no":l&&!k(l)&&(n="Please enter a valid 12-digit Aadhar number");break;case"gender":l||(n="Please select Gender");break;case"dob":E(l)||(n="Please enter a valid Date of Birth");break;case"date_of_join":E(l)||(n="Please enter a valid Date of Joining");break;case"community":l||(n="Please enter Community");break;case"father_name":l?/^[a-zA-Z\s]+$/.test(l)||(n="Father Name must contain only letters and spaces"):n="Please enter Father Name";break;case"father_mobile":f(l)?/^\d{10}$/.test(l)||(n="Mobile number must be 10 digits"):n="Please enter a valid mobile number";break;case"mother_name":l?/^[a-zA-Z\s]+$/.test(l)||(n="Mother Name must contain only letters and spaces"):n="Please enter Mother Name";break;case"mother_mobile":f(l)?/^\d{10}$/.test(l)||(n="Mobile number must be 10 digits"):n="Please enter a valid mobile number";break;case"address":l||(n="Please enter Address");break;case"bookingfees":l||(n="Please enter Booking Fees");break;case"Totalfees":l||(n="Please enter Total Fees");break}return n};d.useEffect(()=>{D.get(`${T.apiURL}/clsAndSec/getClass`).then(m=>{v(m.data)}).catch(m=>{console.log("Error fetching Class data",m)})},[]);const h=m=>{const{name:u,value:n}=m.target,l=M(u,n);j({...r,[u]:l}),y({...i,[u]:n})},S=m=>{m.preventDefault(),b(!0),$(!1);let u={};if(Object.keys(i).forEach(n=>{const l=i[n],f=M(n,l);f&&(u[n]=f)}),Object.keys(u).length>0){j(u),b(!1);return}D.put(`${T.apiURL}/students/updateStudent/${a.stu_id}`,i).then(n=>{n.status===200?($(!0),alert("Update successful"),x(),y({stu_id:"",stu_name:"",aadhar_no:"",gender:"",dob:"",date_of_join:"",cls_id:"",community:"",father_name:"",father_mobile:"",mother_name:"",mother_mobile:"",bookingfees:"",address:"",Totalfees:""}),j({})):(console.error("Unexpected response status:",n.status),j({general:"Update failed. Please try again."})),b(!1)}).catch(n=>{var f,k;console.error("Error:",n);const l=((k=(f=n.response)==null?void 0:f.data)==null?void 0:k.message)||"An error occurred. Please try again.";j({general:l}),b(!1)})};return e.jsxs("div",{children:[e.jsx("h1",{children:"Update Student"}),A&&e.jsx(te,{}),N&&e.jsx("div",{children:"Update submitted successfully!"}),e.jsxs("form",{onSubmit:S,children:[e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,select:!0,name:"cls_id",label:"Class",onChange:h,value:i.cls_id,error:!!r.cls_id,helperText:r.cls_id,children:C.map(m=>e.jsx(_,{value:m.cls_id,children:m.cls_name},m.cls_id))})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Student Name",variant:"outlined",name:"stu_name",value:i.stu_name,error:!!r.stu_name,helperText:r.stu_name})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Aadhar Number",type:"number",name:"aadhar_no",value:i.aadhar_no,variant:"outlined",error:!!r.aadhar_no,helperText:r.aadhar_no})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Date of Birth",InputLabelProps:{shrink:!0},type:"date",name:"dob",onChange:h,value:i.dob,error:!!r.dob,helperText:r.dob})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Date of Joining",InputLabelProps:{shrink:!0},type:"date",name:"date_of_join",onChange:h,value:i.date_of_join,error:!!r.date_of_join,helperText:r.date_of_join})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsxs(g,{fullWidth:!0,select:!0,name:"gender",label:"Gender",onChange:h,value:i.gender,error:!!r.gender,helperText:r.gender,children:[e.jsx(_,{value:"Male",children:"Male"}),e.jsx(_,{value:"Female",children:"Female"})]})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Community",variant:"outlined",name:"community",value:i.community,error:!!r.community,helperText:r.community})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Father's Name",variant:"outlined",name:"father_name",value:i.father_name,error:!!r.father_name,helperText:r.father_name})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Father's Mobile",type:"number",name:"father_mobile",value:i.father_mobile,error:!!r.father_mobile,helperText:r.father_mobile})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Mother's Name",variant:"outlined",name:"mother_name",value:i.mother_name,error:!!r.mother_name,helperText:r.mother_name})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Mother's Mobile",type:"number",name:"mother_mobile",value:i.mother_mobile,error:!!r.mother_mobile,helperText:r.mother_mobile})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Booking Fees",type:"number",name:"bookingfees",value:i.bookingfees,error:!!r.bookingfees,helperText:r.bookingfees})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Total Fees",type:"number",name:"Totalfees",value:i.Totalfees,error:!!r.Totalfees,helperText:r.Totalfees})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,onChange:h,label:"Address",variant:"outlined",name:"address",value:i.address,error:!!r.address,helperText:r.address})})]}),e.jsxs(ae,{mt:2,children:[e.jsx(p,{type:"submit",variant:"contained",color:"primary",children:"Update"}),e.jsx(p,{onClick:x,variant:"outlined",color:"secondary",style:{marginLeft:10},children:"Cancel"})]})]})]})}const V=a=>{if(!a)return"N/A";const x=new Date(a);if(isNaN(x))return"Invalid Date";const C=String(x.getDate()).padStart(2,"0"),v=String(x.getMonth()+1).padStart(2,"0");return`${x.getFullYear()}-${v}-${C}`};function Ce(){const[a,x]=d.useState([]),[C,v]=d.useState([]),[i,y]=d.useState(!1),[r,j]=d.useState(!1),[A,b]=d.useState(!1),[N,$]=d.useState(!1),[M,h]=d.useState(),[S,m]=d.useState(5),[u,n]=d.useState(1),[l,f]=d.useState(""),[k,E]=d.useState();q(),d.useEffect(()=>{D.get(`${T.apiURL}/students/getAllStudents`).then(t=>{x(t.data),console.log("Response data:",t.data)}).catch(t=>{console.log("Error:",t)})},[i,r,A,N]),d.useEffect(()=>{D.get(`${T.apiURL}/clsAndSec/getClass`).then(t=>{v(t.data)}).catch(t=>{console.log("Error fetching Class data",t)})},[]);const s=L(se)(({theme:t})=>({[`&.${R.head}`]:{backgroundColor:t.palette.common.black,color:t.palette.common.white},[`&.${R.body}`]:{fontSize:14}})),G=L(O)(({theme:t})=>({"&:nth-of-type(odd)":{backgroundColor:t.palette.action.hover},"&:last-child td, &:last-child th":{border:0}})),J=t=>{const c=a.find(P=>P.stu_id===t);c&&(h(c),y(!0))},Z=()=>{b(!0)},Y=t=>{D.delete(`${T.apiURL}/students/deleteStudent/${t}`).then(()=>{console.log("Deleted successfully"),$(c=>!c)}).catch(c=>{console.log("Error:",c)})},H=t=>{const c=parseInt(t.target.value,10);m(c),n(1)},Q=(t,c)=>{n(c)},K=t=>{const c=l.toLowerCase();return Object.values(t).some(P=>P&&P.toString().toLowerCase().includes(c))},F=a.filter(K),B=(u-1)*S,X=S>0?u*S:F.length,w=F.slice(B,X),ee=t=>{const c=C.find(P=>P.cls_id==t);return c?c.cls_name:"N/A"};return e.jsxs("div",{children:[e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{item:!0,xs:4,children:[e.jsx(p,{variant:"contained",color:"primary",startIcon:e.jsx(ne,{}),onClick:Z,children:"New Admission"}),e.jsx(re,{to:"/uploadExcel",className:"ms-2",children:e.jsx(p,{variant:"contained",color:"success",children:"Upload Excel"})})]}),e.jsx(o,{item:!0,xs:4,children:e.jsx(g,{label:"Search",onChange:t=>f(t.target.value),value:l})}),e.jsx(o,{item:!0,xs:4,children:e.jsx(le,{children:e.jsxs(ie,{value:S,onChange:H,children:[e.jsx(_,{value:5,children:"5 Per Page"}),e.jsx(_,{value:10,children:"10 Per Page"}),e.jsx(_,{value:15,children:"15 Per Page"}),e.jsx(_,{value:20,children:"20 Per Page"}),e.jsx(_,{value:0,children:"All Per Page"})]})})})]}),e.jsx("br",{}),e.jsx(o,{container:!0,spacing:1,display:"flex",justifyContent:"center",className:"mt-3",children:e.jsx(oe,{spacing:2,children:e.jsx(de,{count:Math.ceil(F.length/S),page:u,onChange:Q,variant:"outlined",sx:{"& .MuiPaginationItem-root":{fontSize:"1.25rem",width:"48px",height:"48px",transition:"all 0.3s ease"},"& .MuiPaginationItem-root:hover":{backgroundColor:"green",color:"#fff",transform:"scale(1.1)"},"& .Mui-selected":{backgroundColor:"green !important",color:"#fff !important"}}})})}),e.jsx("br",{}),e.jsx(ce,{component:he,className:"mt-3",children:e.jsxs(ue,{sx:{minWidth:700},"aria-label":"customized table",children:[e.jsx(me,{children:e.jsxs(O,{children:[e.jsx(s,{children:"S.no"}),e.jsx(s,{align:"right",children:"Student name"}),e.jsx(s,{align:"right",children:"Date Of Birth"}),e.jsx(s,{align:"right",children:"Class"}),e.jsx(s,{align:"right",children:"Date Of Join"}),e.jsx(s,{align:"right",children:"Aadhar no"}),e.jsx(s,{align:"right",children:"Father name"}),e.jsx(s,{align:"right",children:"Mother name"}),e.jsx(s,{align:"right",children:"Father Mobile"}),e.jsx(s,{align:"right",children:"Mother Mobile"}),e.jsx(s,{align:"right",children:"Gender"}),e.jsx(s,{align:"right",children:"Community"}),e.jsx(s,{align:"right",children:"Address"}),e.jsx(s,{align:"right",children:"Booking Fess"}),e.jsx(s,{align:"right",children:"Tution Fess"}),e.jsx(s,{align:"right",children:"Actions"})]})}),e.jsx(ge,{children:w.map((t,c)=>e.jsxs(G,{children:[e.jsx(s,{component:"th",scope:"row",children:B+c+1}),e.jsx(s,{align:"right",children:t.stu_name}),e.jsx(s,{align:"right",children:V(t.dob)}),e.jsx(s,{align:"right",children:ee(t.cls_id)}),e.jsx(s,{align:"right",children:V(t.doj)}),e.jsx(s,{align:"right",children:t.aadhar_no}),e.jsx(s,{align:"right",children:t.father_name}),e.jsx(s,{align:"right",children:t.mother_name}),e.jsx(s,{align:"right",children:t.father_mobile}),e.jsx(s,{align:"right",children:t.mother_mobile}),e.jsx(s,{align:"right",children:t.gender}),e.jsx(s,{align:"right",children:t.community}),e.jsx(s,{align:"right",children:t.address}),e.jsx(s,{align:"right",children:t.bookingfees}),e.jsx(s,{align:"right",children:t.tution_fees}),e.jsxs(s,{align:"right",children:[e.jsx(p,{variant:"contained",color:"error",fullWidth:!0,startIcon:e.jsx(xe,{}),onClick:()=>Y(t.stu_id),children:"Delete"}),e.jsx(p,{variant:"contained",color:"primary",fullWidth:!0,startIcon:e.jsx(fe,{}),onClick:()=>J(t.stu_id),children:"Edit"})]})]},t.stu_id))})]})}),e.jsxs(U,{open:r,onClose:()=>j(!1),children:[e.jsx(W,{children:e.jsx(je,{data:k,onClose:()=>j(!1)})}),e.jsx(I,{children:e.jsx(p,{onClick:()=>j(!1),children:"Close"})})]}),e.jsxs(U,{open:A,onClose:()=>b(!1),children:[e.jsx(W,{children:e.jsx(be,{data:k,onClose:()=>b(!1)})}),e.jsx(I,{children:e.jsx(p,{onClick:()=>b(!1),children:"Close"})})]}),e.jsxs(U,{open:i,onClose:()=>y(!1),children:[e.jsx(W,{children:e.jsx(pe,{data:M,onClose:()=>y(!1)})}),e.jsx(I,{children:e.jsx(p,{onClick:()=>y(!1),children:"Close"})})]})]})}export{Ce as default};
